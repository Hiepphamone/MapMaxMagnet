repeat wait(1) until game.Players
repeat wait(1) until game.Players.LocalPlayer
repeat wait(1) until game.ReplicatedStorage
repeat wait(1) until game:GetService("Players").LocalPlayer:FindFirstChild("PlayerGui")
repeat wait(1) until game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("Main")
local vu = game:GetService("VirtualUser")
local plr = game.Players.LocalPlayer
local Client = require(game.ReplicatedStorage.Library.Client)

function dbuoi()
    for i,v in pairs(game:GetService("Workspace")["__THINGS"].Orbs:GetChildren()) do
        v.CanCollide = false
        v.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,0,0)
    end
    
    for i,v in pairs(game:GetService("Workspace")["__THINGS"].Lootbags:GetDescendants()) do
        if v:IsA("MeshPart") then
            v.CanCollide = false
            v.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,0,0)
        end
    end
end

function attack()
    local a = {}
    for i,v in pairs(game:GetService("Workspace")["__THINGS"].Breakables:GetChildren()) do
        for i1,v1 in pairs(v:GetChildren()) do
            if (v1.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude < 60 and #a < 2 then
                return v.Name
            end
        end
    end
end

function destroyvipzone()
    for i,v in pairs(workspace.Map["1 | Spawn"].INTERACT.BREAK_ZONES:GetChildren()) do
        if tostring(v.Position) == "214.12213134765625, 24.417156219482422, -587.1192626953125" then
            print("A")
           v:Destroy() 
        end
    end
end

destroyvipzone()

game:GetService("RunService").Heartbeat:Connect(function()
    spawn(function()
	    game:GetService("ReplicatedStorage").Network.Breakables_PlayerDealDamage:FireServer(attack())
    end)
end)

function hasunlockzones(name) 
    return Client.Zones.Owns(name)
end

function getnextmap()
    return Client.ZoneCmds.GetNextZone()
end

function getlastmap()
    return Client.ZoneCmds.GetMaxOwnedZone()
end

function formatclient(name)
    local pattern = " table: .*$"
    local result = name:gsub(pattern, "") 
    return result
end

function formatmap(text)
    local result = string.match(text, "| (.*)$")
    return result
end

function getlocation()
    for i,v in pairs(workspace.Map:GetChildren()) do
        if formatmap(v.Name) == formatclient(getlastmap()) then
            return v.INTERACT.BREAK_ZONES.BREAK_ZONE
        end
    end
    return false
end

function unlockmapattk()
    game:GetService("ReplicatedStorage").Network.Zones_RequestPurchase:InvokeServer(formatclient(getnextmap()))
    pcall(dbuoi)
end

function loop1()
    while true do wait(5)
        pcall(unlockmapattk)
    end
end

spawn(loop1)

function unlockmap()
    if not hasunlockzones("Beach") then
        if (plr.Character.HumanoidRootPart.Position - getlocation().Position).Magnitude > 30 then
            plr.Character.HumanoidRootPart.CFrame = getlocation().CFrame
        end
    else
    end
end

while true do wait()
    local a,b = pcall(unlockmap)
    print(a,b)
end
